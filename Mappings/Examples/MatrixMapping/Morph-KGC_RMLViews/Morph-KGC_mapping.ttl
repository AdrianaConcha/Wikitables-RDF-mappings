@prefix rr: <http://www.w3.org/ns/r2rml#>.
@prefix rml: <http://semweb.mmlab.be/ns/rml#>.
@prefix ql: <http://semweb.mmlab.be/ns/ql#>.
@prefix transit: <http://vocab.org/transit/terms/>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix wgs84_pos: <http://www.w3.org/2003/01/geo/wgs84_pos#>.
@prefix wd: <http://www.wikidata.org/entity/>.
@prefix wds: <http://www.wikidata.org/entity/statement/>.
@prefix wdv: <http://www.wikidata.org/value/>.
@prefix wdt: <http://www.wikidata.org/prop/direct/>.
@prefix p: <http://www.wikidata.org/prop/>.
@prefix ps: <http://www.wikidata.org/prop/statement/>.
@prefix pq: <http://www.wikidata.org/prop/qualifier/>.


<#MatrixMapping> a rr:TriplesMap;

rml:logicalSource [
	rml:query """
	SELECT SPLIT_PART(Period, '-' ,1) AS 'start', SPLIT_PART(Period, '-' ,2) AS 'end', ArticleEntity AS 'location', precipitationYear
	FROM (
		SELECT ArticleEntity, REGEXP_REPLACE(p, REGEXP_REPLACE(p, '^([0-9]{4}-[0-9]{4}?)', '', 'ig'), '', 'ig') AS 'Period',precipitationYear
		FROM (
			SELECT Year AS 'precipitationYear', ArticleEntity,  REGEXP_REPLACE(Title, '[^0-9-]', '', 'ig') AS 'p'
			FROM '../Input/975024_1.csv'
			WHERE Month = 'Q25257'
		)
	)	"""
];

rr:subjectMap [
	rr:template "http://www.wikidata.org/entity/{location}";
];

rr:predicateObjectMap [
	rr:predicate p:avgPrecipitation;
	rr:objectMap [
		rr:termType rr:BlankNode ;
		rr:template "_:source{location}{start}{end}{precipitationYear}"
	]
].


<#Precipitation> a rr:TriplesMap;
rml:logicalSource [
	rml:query """
	SELECT SPLIT_PART(Period, '-' ,1) AS 'start', SPLIT_PART(Period, '-' ,2) AS 'end', ArticleEntity AS 'location', precipitationYear
	FROM (
		SELECT ArticleEntity, REGEXP_REPLACE(p, REGEXP_REPLACE(p, '^([0-9]{4}-[0-9]{4}?)', '', 'ig'), '', 'ig') AS 'Period',precipitationYear
		FROM (
			SELECT Year AS 'precipitationYear', ArticleEntity,  REGEXP_REPLACE(Title, '[^0-9-]', '', 'ig') AS 'p'
			FROM '../Input/975024_1.csv'
			WHERE Month = 'Q25257'
		)
	)	"""
];


rr:subjectMap [
	rr:termType rr:BlankNode;
	rr:template "_:source{location}{start}{end}{precipitationYear}"
];

rr:predicateObjectMap [
	rr:predicate ps:avgPrecipitation;
	rr:objectMap [
		rml:reference "precipitationYear" 
    	]
];


  rr:predicateObjectMap [
    rr:predicate pq:P580;
    rr:objectMap [
      rml:reference "start"
     
    ]
    ];

  rr:predicateObjectMap [
    rr:predicate pq:P582;
    rr:objectMap [
      rml:reference "end"
     
    ]
    ].






